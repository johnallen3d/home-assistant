#!/bin/bash
#MISE description="Generate esphome/secrets.yaml from Doppler"
set -e

REPO_ROOT="$(cd "$(dirname "$0")/../.." && pwd)"

# Load secrets via Doppler if not already loaded
if [[ -z "$WIFI_SSID" ]]; then
    exec doppler run -- "$0" "$@"
fi

cat > "$REPO_ROOT/esphome/secrets.yaml" << EOF
# ESPHome secrets file
# Generated from Doppler - do not edit manually
wifi_ssid: "$WIFI_SSID"
wifi_password: "$WIFI_PASSWORD"
EOF

echo "âœ… Generated esphome/secrets.yaml"
