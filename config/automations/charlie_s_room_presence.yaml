id: '1765129357442'
alias: "Charlie's Room Presence"
description: "Control Charlie's room devices based on presence - Shapes light and sound machine. Uses custom binary sensor with GPS + WiFi fallback and staleness timeout."
triggers:
  - trigger: state
    entity_id: binary_sensor.charlie_home
    to: "on"
    id: charlie_home
  - trigger: state
    entity_id: binary_sensor.charlie_home
    to: "off"
    id: charlie_away
actions:
  - choose:
      - conditions:
          - condition: trigger
            id: charlie_home
        sequence:
          - action: notify.mobile_app_john_allens_iphone
            data:
              title: "HA Presence: Charlie Arrived"
              message: >-
                HA thinks Charlie arrived at {{ now().strftime('%-I:%M %p') }}
          - action: light.turn_on
            target:
              entity_id: light.charlie_s_shapes
          - action: switch.turn_on
            target:
              entity_id: switch.sound_machine_outlet
      - conditions:
          - condition: trigger
            id: charlie_away
        sequence:
          - action: notify.mobile_app_john_allens_iphone
            data:
              title: "HA Presence: Charlie Left"
              message: >-
                HA thinks Charlie left at {{ now().strftime('%-I:%M %p') }}
          - action: light.turn_off
            target:
              entity_id: light.charlie_s_shapes
          - action: switch.turn_off
            target:
              entity_id: switch.sound_machine_outlet
mode: single
