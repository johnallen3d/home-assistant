# Hobby Mode State Handler
# Reacts to hobby_mode boolean changes to control living room lighting.
#
# The boolean (input_boolean.hobby_mode) is the user-facing switch:
# - Exposed to HomeKit as a switch (shows ON/OFF state)
# - Visible on dashboards as a toggle
#
# This automation handles the lighting logic:
# - ON: Activate hobby time scene (bright focused lighting)
# - OFF: Check presence and turn off lights appropriately
#   - If presence detected: lights stay on
#   - If no presence: wait presence_delay, then turn off
#
# Note: When hobby_mode is ON, living_room_presence_lighting automation
# won't turn off lights (protects against leaving for a drink/snack).

id: '1735523100000'
alias: "Hobby Mode Changed"
description: "Handle hobby mode state changes - activate scene or check presence for off"
mode: single

triggers:
  - trigger: state
    entity_id: input_boolean.hobby_mode
    to: "on"
    id: hobby_on
  - trigger: state
    entity_id: input_boolean.hobby_mode
    to: "off"
    id: hobby_off

actions:
  - choose:
      # Hobby mode turned ON - set up hobby lighting
      - conditions:
          - condition: trigger
            id: hobby_on
        sequence:
          # Bright, focused lighting for projects
          - action: light.turn_on
            target:
              entity_id: light.living_room_light
            data:
              brightness_pct: 80
              color_temp_kelvin: 4000
          - action: light.turn_on
            target:
              entity_id: light.living_room_overhead_light
            data:
              brightness_pct: 70
              color_temp_kelvin: 4000
          # Turn off distracting lights
          - action: light.turn_off
            target:
              entity_id:
                - light.island_bulb
                - light.sink_bulb
                - light.hue_lightstrip_plus_1
                - light.bedroom_lights
          - action: switch.turn_off
            target:
              entity_id: switch.kitchen_counter_switch

      # Hobby mode turned OFF - check presence for light control
      - conditions:
          - condition: trigger
            id: hobby_off
        sequence:
          - choose:
              # Living room presence detected - lights stay on
              - conditions:
                  - condition: state
                    entity_id: binary_sensor.kitchen_presence_living_room
                    state: "on"
                sequence: []
            # No presence detected - wait for presence_delay before turning off
            # This gives time to walk into detection zone after toggling
            default:
              - wait_for_trigger:
                  - trigger: state
                    entity_id: binary_sensor.kitchen_presence_living_room
                    to: "on"
                timeout:
                  seconds: "{{ states('input_number.presence_delay') | int(5) }}"
              # Only turn off if no presence detected during wait
              - if:
                  - condition: template
                    value_template: "{{ wait.trigger is none }}"
                then:
                  - action: light.turn_off
                    target:
                      entity_id: light.living_room_lights
