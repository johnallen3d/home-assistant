id: '1765317032345'
alias: "Unlock Door on Arrival"
description: >-
  Unlocks the front door when arriving home. Uses dual-verification: GPS zone entry triggers the automation, then waits for WiFi connection to confirm you're actually home before unlocking. Includes delays to avoid GPS jitter false positives.
triggers:
  - trigger: zone
    entity_id: person.john_allen
    zone: zone.home
    event: enter
conditions:
  # Only run if the door is currently locked
  - condition: state
    entity_id: lock.nuki_smart_lock
    state: locked
actions:
  # Wait for WiFi confirmation (iPhone connects to home network)
  # This is a stronger signal than GPS alone
  - wait_for_trigger:
      - trigger: state
        entity_id: device_tracker.iphone
        to: home
    timeout:
      minutes: 5
    continue_on_timeout: false
  # Final check: still home on GPS and WiFi, and door still locked
  - condition: state
    entity_id: person.john_allen
    state: home
  - condition: state
    entity_id: device_tracker.iphone
    state: home
  - condition: state
    entity_id: lock.nuki_smart_lock
    state: locked
  # Unlock the door
  - action: lock.unlock
    target:
      entity_id: lock.nuki_smart_lock
mode: single
