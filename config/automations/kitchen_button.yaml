id: '1763158818464'
alias: Kitchen Button
description: Handle single, double, and long presses for the kitchen button
triggers:
  - trigger: state
    entity_id: event.smart_button_button
    not_from:
      - unknown
      - unavailable
    not_to:
      - unknown
      - unavailable
conditions:
  # Reject stale events from Thread reconnects. Event entity state is the
  # timestamp of the last event; if it's more than 5 seconds old the device
  # is just re-reporting after a connectivity drop.
  - condition: template
    value_template: >-
      {{ (now() - states.event.smart_button_button.last_updated).total_seconds() < 5 }}
actions:
  - choose:
      # Single press: Toggle cooking mode (scene + helper that protects from auto-off)
      - conditions:
          - condition: template
            value_template: '{{ state_attr(''event.smart_button_button'', ''event_type'') == ''multi_press_1'' }}'
        sequence:
          - action: script.toggle_cooking
      - conditions:
          - condition: template
            value_template: '{{ state_attr(''event.smart_button_button'', ''event_type'') == ''multi_press_2'' }}'
        sequence:
          - action: script.kitchen_chill
      - conditions:
          - condition: template
            value_template: '{{ state_attr(''event.smart_button_button'', ''event_type'') == ''long_press'' }}'
        sequence:
          - action: homeassistant.turn_off
            target:
              entity_id: group.kitchen_all
mode: single
